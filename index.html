<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¬ç¢§æšæ•¸ä½åç‰‡ (å•Ÿå‹•ä¸­...)</title>
    <!-- 1. å¼·åˆ¶æ¨£å¼ï¼šé˜²æ­¢ Tailwind è¼‰å…¥å¤±æ•—å°è‡´ç™½ç•«é¢ -->
    <style>
        body { 
            background-color: #0F172A !important; 
            color: white !important; 
            font-family: sans-serif;
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            text-align: center;
        }
        #debug-console {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(0,0,0,0.8);
            color: #00ff00;
            font-size: 12px;
            padding: 5px;
            text-align: left;
            z-index: 9999;
            max-height: 150px;
            overflow-y: auto;
            border-top: 1px solid #333;
            display: none; /* é è¨­éš±è—ï¼Œå‡ºéŒ¯é–‹å•Ÿ */
        }
        .gold-bg { background: linear-gradient(135deg, #C0A062 0%, #a68a52 100%); }
    </style>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- LIFF SDK -->
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
</head>
<body class="p-6">

    <div class="max-w-xs w-full">
        <!-- ç‹€æ…‹é¡¯ç¤º -->
        <div id="statusUI">
            <div class="w-12 h-12 border-4 border-[#C0A062] border-t-transparent rounded-full animate-spin mx-auto mb-6"></div>
            <h1 class="text-xl font-bold mb-2 tracking-wide">åç‰‡è¼‰å…¥ä¸­...</h1>
            <p id="statusText" class="text-gray-400 text-sm">æ­£åœ¨é€£æ¥ LINE ä¼ºæœå™¨</p>
        </div>

        <!-- æ‰‹å‹•ç™¼é€æŒ‰éˆ• -->
        <div id="manualUI" class="hidden" style="display:none;">
            <div class="w-16 h-16 gold-bg rounded-2xl mx-auto mb-6 flex items-center justify-center shadow-2xl">
                <i class="fas fa-paper-plane text-white text-2xl"></i>
            </div>
            <h1 class="text-xl font-bold mb-2">åç‰‡æº–å‚™å®Œæˆ</h1>
            <p class="text-gray-400 text-xs mb-8">è‹¥æœªè‡ªå‹•è·³è½‰ï¼Œè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•</p>
            <button onclick="sendCard()" class="w-full py-4 gold-bg text-white rounded-2xl font-bold text-lg shadow-lg">
                ç™¼é€åç‰‡
            </button>
        </div>

        <!-- éŒ¯èª¤ UI -->
        <div id="errorUI" class="hidden" style="display:none;">
            <div class="bg-red-900/50 border border-red-500 p-6 rounded-xl text-left">
                <h1 class="text-red-300 font-bold mb-2">ç™¼ç”ŸéŒ¯èª¤</h1>
                <p id="errorDetail" class="text-gray-200 text-xs break-all font-mono mb-4"></p>
                <button onclick="window.location.reload()" class="w-full mt-4 py-2 bg-white/20 rounded text-xs text-white">é‡æ–°è¼‰å…¥</button>
            </div>
        </div>
    </div>

    <!-- è¢å¹•é™¤éŒ¯è¦–çª— -->
    <div id="debug-console"></div>

    <script>
        // ================= è¨­å®šå€ =================
        const MY_LIFF_ID = "2009040903-BGxJ5Hxk"; 
        
        const LINK_LINE = "https://line.me/ti/p/QtVURAgio1";
        const LINK_INSTAGRAM = "https://www.instagram.com/l______6?igsh=MWltOXpweDlmd2l1MA%3D%3D&utm_source=qr";
        const LINK_FACEBOOK = "https://www.facebook.com/share/189BkfUWPy/?mibextid=wwXIfr";
        const LINK_PHONE = "tel:0975748295";

        const IMG_PROFILE = "https://i.postimg.cc/ydYK8D4r/A41E59A4-95CD-43DE-83A0-D1D6BB549FB7.jpg"; 
        const IMG_SERVICE = "https://i.postimg.cc/PJJfxyfP/VIP_%E8%B2%A1%E5%8B%99%E7%AD%96%E5%8A%83%E6%9B%B8_16%E6%AF%949.png";
        const IMG_COMPANY = "https://i.postimg.cc/3NNrR1rY/%E5%9C%96%E7%89%871.jpg";

        // ================= æ ¸å¿ƒé‚è¼¯ =================

        // è¢å¹•æ—¥èªŒå·¥å…· (è®“æ‚¨åœ¨æ‰‹æ©Ÿä¸Šä¹Ÿèƒ½çœ‹åˆ°éŒ¯èª¤)
        function log(msg) {
            console.log(msg);
            const consoleDiv = document.getElementById('debug-console');
            if(consoleDiv) {
                consoleDiv.style.display = 'block'; // æœ‰è¨Šæ¯å°±é¡¯ç¤º
                consoleDiv.innerHTML += `<div>> ${msg}</div>`;
                // è‡ªå‹•æ²å‹•åˆ°åº•éƒ¨
                consoleDiv.scrollTop = consoleDiv.scrollHeight;
            }
            // æ›´æ–°ç‹€æ…‹æ–‡å­—è®“ç”¨æˆ¶çŸ¥é“é€²åº¦
            const statusText = document.getElementById('statusText');
            if(statusText) statusText.innerText = msg;
        }

        // éŒ¯èª¤è™•ç†
        window.onerror = function(msg, url, line) {
            log(`ERROR: ${msg} (Line: ${line})`);
            showUI('errorUI', `ç³»çµ±éŒ¯èª¤: ${msg}`);
            return false;
        };

        function showUI(id, errMsg = "") {
            document.getElementById('statusUI').style.display = 'none';
            document.getElementById('manualUI').style.display = 'none';
            document.getElementById('errorUI').style.display = 'none';
            
            const target = document.getElementById(id);
            if(target) {
                target.style.display = 'block';
                target.classList.remove('hidden'); // Tailwind ç›¸å®¹
            }

            if(id === 'errorUI' && errMsg) {
                document.getElementById('errorDetail').innerText = errMsg;
            }
        }

        const cardJson = {
          "type": "carousel",
          "contents": [
            {
              "type": "bubble", "size": "mega",
              "header": { "type": "box", "layout": "vertical", "backgroundColor": "#111111", "paddingAll": "16px", "contents": [ { "type": "text", "text": "PROFESSIONAL PROFILE", "color": "#C0A062", "size": "xxs", "weight": "bold" }, { "type": "text", "text": "01", "color": "#222222", "align": "end", "size": "3xl", "weight": "bold", "position": "absolute", "offsetTop": "5px", "offsetEnd": "15px" } ] },
              "hero": { "type": "image", "url": IMG_PROFILE, "size": "full", "aspectRatio": "1:1", "aspectMode": "cover", "backgroundColor": "#F3F4F6" },
              "body": { "type": "box", "layout": "vertical", "paddingAll": "20px", "contents": [ { "type": "text", "text": "è¬ç¢§æš æ¥­å‹™è¥„ç†", "weight": "bold", "size": "xl", "color": "#111827" }, { "type": "text", "text": "å¾¡è¬™VIPèè‹±æœƒ", "size": "xs", "color": "#C0A062", "margin": "xs", "weight": "bold" }, { "type": "separator", "margin": "md", "color": "#EEEEEE" }, { "type": "box", "layout": "vertical", "margin": "md", "spacing": "sm", "contents": [ { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "CIA500 å¼·åœ˜éšŠ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }, { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "åœ˜éšŠç´¯ç©ç®¡ç†å®¢æˆ¶è³‡é‡‘é«˜é” 20 å„„", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }, { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "å…¨å° RFP è²¡å‹™ç­–åŠƒå¸«æœ€é«˜æ¿ƒåº¦åœ˜éšŠ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] } ] } ] },
              "footer": { "type": "box", "layout": "vertical", "spacing": "sm", "paddingAll": "16px", "contents": [ { "type": "button", "style": "primary", "height": "sm", "color": "#C0A062", "action": { "type": "uri", "label": "âœ¨ åŠ  LINE å¥½å‹", "uri": LINK_LINE } }, { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "ğŸ“ æ’¥æ‰“é›»è©±", "uri": LINK_PHONE } }, { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "â¤ åˆ†äº«çµ¦å¥½å‹", "uri": "https://liff.line.me/" + MY_LIFF_ID } } ] }
            },
            {
              "type": "bubble", "size": "mega",
              "header": { "type": "box", "layout": "vertical", "backgroundColor": "#111111", "paddingAll": "16px", "contents": [ { "type": "text", "text": "SERVICES & SOLUTIONS", "color": "#C0A062", "size": "xxs", "weight": "bold" }, { "type": "text", "text": "02", "color": "#222222", "align": "end", "size": "3xl", "weight": "bold", "position": "absolute", "offsetTop": "5px", "offsetEnd": "15px" } ] },
              "hero": { "type": "image", "url": IMG_SERVICE, "size": "full", "aspectRatio": "1:1", "aspectMode": "fit", "backgroundColor": "#1a1a1a" },
              "body": { "type": "box", "layout": "vertical", "paddingAll": "20px", "contents": [ { "type": "text", "text": "å®¢è£½åŒ–è²¡å‹™ç­–åŠƒæ›¸", "weight": "bold", "size": "xl", "color": "#111827" }, { "type": "text", "text": "WEALTH MANAGEMENT", "size": "xs", "color": "#9ca3af", "margin": "xs" }, { "type": "separator", "margin": "md", "color": "#EEEEEE" }, { "type": "box", "layout": "vertical", "margin": "md", "spacing": "sm", "contents": [ { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "é‡‘æµè¦åŠƒ - æˆ¿è²¸æ¸›å… | é€€ä¼‘è¦åŠƒ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }, { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "é¢¨éšªè¦åŠƒ - æ¸›å°‘ä¿è²» | æé«˜ä¿éšœ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }, { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "è²¡å‹™è¦åŠƒ - è³‡ç”¢é…ç½® | ä¿¡è²¸æ•´åˆ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }, { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "æ•™è‚²æ—…éŠ - å­å¥³æ•™è‚² | å…è²»å‡ºåœ‹", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }, { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "å®¶æ—å‚³æ‰¿ - ä¿¡è¨— | å‚³æ‰¿ | å°Šåš´", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] } ] } ] },
              "footer": { "type": "box", "layout": "vertical", "spacing": "sm", "paddingAll": "16px", "contents": [ { "type": "button", "style": "primary", "height": "sm", "color": "#C0A062", "action": { "type": "uri", "label": "ğŸ“œ ä»€éº¼æ˜¯ RFP?", "uri": "https://www.rfpi.com.tw/portal_a1.php?owner_num=a1_205771&button_num=a1" } }, { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "ğŸ“· instagram", "uri": LINK_INSTAGRAM } }, { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "ğŸ“˜ facebook", "uri": LINK_FACEBOOK } } ] }
            },
            {
              "type": "bubble", "size": "mega",
              "header": { "type": "box", "layout": "vertical", "backgroundColor": "#111111", "paddingAll": "16px", "contents": [ { "type": "text", "text": "COMPANY OVERVIEW", "color": "#C0A062", "size": "xxs", "weight": "bold" }, { "type": "text", "text": "03", "color": "#222222", "align": "end", "size": "3xl", "weight": "bold", "position": "absolute", "offsetTop": "5px", "offsetEnd": "15px" } ] },
              "hero": { "type": "image", "url": IMG_COMPANY, "size": "full", "aspectRatio": "1:1", "aspectMode": "fit", "backgroundColor": "#1a1a1a" },
              "body": { "type": "box", "layout": "vertical", "paddingAll": "20px", "contents": [ { "type": "text", "text": "å¾¡è¬™VIPèè‹±æœƒ", "weight": "bold", "size": "xl", "color": "#111827" }, { "type": "text", "text": "GROUP PROFILE", "size": "xs", "color": "#9ca3af", "margin": "xs" }, { "type": "separator", "margin": "md", "color": "#EEEEEE" }, { "type": "box", "layout": "vertical", "margin": "md", "spacing": "sm", "contents": [ { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "ä¸–ç•Œ CIA500 å¼·åœ˜éšŠ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }, { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "[å°ˆå±¬è²¡å‹™è¦åŠƒ] å®¢è£½åŒ–æ–¹æ¡ˆ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }, { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "[äººæ‰åŸ¹è¨“è¦åŠƒ] ç™¾è¬å¹´è–ªåŸ¹è¨“", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }, { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "â˜…", "color": "#C0A062", "size": "sm", "flex": 0 }, { "type": "text", "text": "[è³‡æºæ•´åˆæœå‹™] å°ˆæ¥­æœƒè¨ˆå¸«åˆä½œ", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] }, { "type": "box", "layout": "baseline", "spacing": "sm", "contents": [ { "type": "text", "text": "[è²¡ç¶“æ•™è‚²è¬›åº§] ç¨…å‹™æŠ•è³‡è¬›åº§", "color": "#666666", "size": "sm", "flex": 1, "wrap": true, "weight": "bold" } ] } ] } ] },
              "footer": { "type": "box", "layout": "vertical", "spacing": "sm", "paddingAll": "16px", "contents": [ { "type": "button", "style": "primary", "height": "sm", "color": "#C0A062", "action": { "type": "uri", "label": "ğŸ“· å¾¡è¬™ Instagram", "uri": "https://www.instagram.com/youtrend_vip" } }, { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "ğŸ“˜ å¾¡è¬™ Facebook", "uri": "https://www.facebook.com/share/1CsML2XrDx/" } }, { "type": "button", "style": "primary", "height": "sm", "color": "#404040", "action": { "type": "uri", "label": "ğŸ“ å…¬å¸åœ°å€", "uri": "https://maps.app.goo.gl/81JB2KBH2fMA87Dz7" } } ] }
            }
          ]
        };

        async function sendCard() {
            try {
                if (!liff.isLoggedIn()) {
                    log("å°šæœªç™»å…¥ï¼Œè«‹é‡æ•´æˆ–æ‰‹å‹•ç™»å…¥");
                    liff.login();
                    return;
                }
                
                log("æ­£åœ¨å–šèµ·åˆ†äº«è¦–çª—...");
                const res = await liff.shareTargetPicker([
                    { type: "flex", altText: "è¬ç¢§æšæ•¸ä½åç‰‡", contents: cardJson }
                ]);

                if (res) {
                    log("åˆ†äº«æˆåŠŸï¼Œé—œé–‰è¦–çª—");
                    liff.closeWindow();
                } else {
                    log("ç”¨æˆ¶å–æ¶ˆç™¼é€");
                    showUI('manualUI');
                }
            } catch (err) {
                console.error(err);
                if (err.code === "EXCEPTION_IN_SUBWINDOW" || err.message.includes("EXCEPTION_IN_SUBWINDOW")) {
                    showUI('manualUI');
                } else {
                    showUI('errorUI', `ç™¼é€å¤±æ•—: ${err.message}`);
                }
            }
        }

        async function main() {
            log("ç¨‹å¼é–‹å§‹åŸ·è¡Œ...");
            
            // æª¢æŸ¥ LIFF SDK æ˜¯å¦çœŸçš„è¼‰å…¥
            if (typeof liff === 'undefined') {
                showUI('errorUI', "LIFF SDK è¼‰å…¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²è·¯æˆ– AdBlock");
                return;
            }

            try {
                log(`åˆå§‹åŒ– LIFF: ${MY_LIFF_ID}`);
                await liff.init({ liffId: MY_LIFF_ID });
                log("LIFF åˆå§‹åŒ–æˆåŠŸ");

                // æª¢æŸ¥æ˜¯å¦æ˜¯åœ¨ LINE App å¤–éƒ¨ (ä¾‹å¦‚é›»è…¦ç€è¦½å™¨)
                if (!liff.isInClient() && !liff.isLoggedIn()) {
                    log("æª¢æ¸¬åˆ°æœªç™»å…¥ï¼Œæº–å‚™è·³è½‰...");
                    liff.login(); // é€™æœƒå°è‡´é é¢è·³è½‰
                    return;
                }

                // å¦‚æœå·²ç¶“ç™»å…¥ï¼Œç›´æ¥åŸ·è¡Œ
                if (liff.isLoggedIn()) {
                    log("å·²ç™»å…¥ï¼Œå˜—è©¦ç™¼é€...");
                    sendCard();
                } else {
                    showUI('manualUI');
                }

            } catch (err) {
                log("CRITICAL ERROR: " + err.message);
                showUI('errorUI', `LIFF åˆå§‹åŒ–éŒ¯èª¤: ${err.message}\nè«‹æª¢æŸ¥ LIFF ID æ˜¯å¦æ­£ç¢º`);
            }
        }

        // ç¢ºä¿ DOM è¼‰å…¥å¾Œæ‰åŸ·è¡Œ
        window.onload = function() {
            // å»¶é²ä¸€é»é»åŸ·è¡Œï¼Œç¢ºä¿ SDK è·‘å®Œ
            setTimeout(main, 100);
        };
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/js/all.min.js"></script>
</body>
</html>